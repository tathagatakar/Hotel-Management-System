<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">


<body class="d-flex">
    <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
        <h1>Pay bill here</h1>
        <br>
        <div class="card px-3" style="width: 50%">
            <div class="card-body">
                <h5 class="card-title">Booking Details:</h5><br>
                <div> <strong>Customer Name:</strong> <%= name %></div>
                <div><strong>Customer User Name:</strong> <%= uName %></div>
                <div><strong>Room No</strong>: <%= rn %></div>
                <div><strong>No. of Guests:</strong> <%= guestCount %></div>
                <div><strong>Price:</strong> <%= price %></div>
                <div><strong>CheckIn:</strong> <%= cin %></div>
                <div><strong>CheckOut:</strong> <%= cout %></div>
            </div>
        </div>
        
        
        <br>
        
        <button class="btn btn-success" id="rzp-button1" style="width:50%">Pay & Book Now</button>
    </div>  
</body>


<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    var orderId;
    $("button").hide();

    $(document).ready(function () {
        var settings = {
            "url": "/create/orderId",
            "method": "POST",
            "timeout": 0,
            "headers": {
                "Content-Type": "application/json"
            },
            "data": JSON.stringify({
                "amount": "<%=price%>00"
            }),
        };

        $.ajax(settings).done(function (response) {

            orderId = response.orderId;
            console.log(orderId);
            $("button").show();
        });
    });

    document.getElementById('rzp-button1').onclick = function (e) {
        var options = {
            "key": "<%=k1%>", 
            "amount": "<%=price%>00",
            "currency": "INR",
            "name": "Hotel Management System",
            "description": "Test Transaction",
            "image": "https://example.com/your_logo",
            "order_id": orderId, 
            "handler": function (response) {
                // alert(response.razorpay_payment_id);
                // alert(response.razorpay_order_id);
                // alert(response.razorpay_signature);
                alert("Payment Successful!");
                var settings = {
                    "url": "/api/payment/verify",
                    "method": "POST",
                    "timeout": 0,
                    "headers": {
                        "Content-Type": "application/json"
                    },
                    "data": JSON.stringify({response}),
                }
            },

            "theme": {
                "color": "#99cc33"
            }
        };
        var rzp1 = new Razorpay(options);
        rzp1.on('payment.failed', function (response) {
            // alert(response.error.code);
            // alert(response.error.description);
            // alert(response.error.source);
            // alert(response.error.step);
            // alert(response.error.reason);
            // alert(response.error.metadata.order_id);
            // alert(response.error.metadata.payment_id);
            alert("Payment Failed");
        });
        rzp1.open();
        e.preventDefault();
    }
</script>